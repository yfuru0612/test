<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wellness-log</title>
</head>
<body>
  <h2>Log</h2>
  <form id="logForm">
    <label>日付: <input type="date" name="date" id="dateInput" required></label><br>
    <label>時間: <input type="time" name="time" id="timeInput" required></label><br>
    <label>項目: <select name="type" id="typeSelect"></select></label><br>
    <label>カテゴリ1: <select name="cate1" id="cate1Select"></select></label><br>
    <label>カテゴリ2: <select name="cate2" id="cate2Select"></select></label><br>
    <label>カテゴリ3: <select name="cate3" id="cate3Select"></select></label><br>

    <!-- <label>項目: <input type="text" name="type"></label><br>
    <label>カテゴリ1: <input type="text" name="cate1"></label><br>
    <label>カテゴリ2: <input type="text" name="cate2"></label><br>
    <label>カテゴリ3: <input type="text" name="cate3"></label><br> -->

    <label>コンディション: <input type="text" name="Condition"></label><br>
    <label>値: 
      <select name="value">
        <option value="-3">-3</option>
        <option value="-2">-2</option>
        <option value="-1">-1</option>
        <option value="0" selected>0</option>
        <option value="1">+1</option>
        <option value="2">+2</option>
        <option value="3">+3</option>
      </select> 
    </label><br>



    <button type="submit">送信</button>
  </form>

  <script>
    // 日付・時間のデフォルト入力
    window.onload = function() {
      const now = new Date();
      const date = now.toISOString().slice(0, 10); // yyyy-mm-dd
      const time = now.toTimeString().slice(0, 5); // hh:mm

      document.getElementById("dateInput").value = date;
      document.getElementById("timeInput").value = time;
    };

    //定義ファイルを読み込む
    const OPTIONS_URL = "https://yfuru0612.github.io/wellness-log/options.json";
    let optionsTree = {};

    fetch(OPTIONS_URL)
      .then(response => response.json())
      .then(data => {
        optionsTree = data;
        populateSelect("typeSelect", Object.keys(data));
      })
      .catch(error => console.error("選択肢の読み込みに失敗しました:", error));

    function populateSelect(selectId, options) {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">--選んでください--</option>';
      options.forEach(value => {
        const opt = document.createElement("option");
        opt.value = value;
        opt.textContent = value;
        select.appendChild(opt);
      });
    }

    // 依存関係に応じて選択肢を動的に更新
    document.getElementById("typeSelect").addEventListener("change", function () {
      const type = this.value;
      const cate1Options = type && optionsTree[type] ? Object.keys(optionsTree[type]) : [];
      populateSelect("cate1Select", cate1Options);
      populateSelect("cate2Select", []);
      populateSelect("cate3Select", []);
    });

    document.getElementById("cate1Select").addEventListener("change", function () {
      const type = document.getElementById("typeSelect").value;
      const cate1 = this.value;
      const cate2Options =
        type && cate1 && optionsTree[type] && optionsTree[type][cate1]
          ? Object.keys(optionsTree[type][cate1])
          : [];
      populateSelect("cate2Select", cate2Options);
      populateSelect("cate3Select", []);
    });

    document.getElementById("cate2Select").addEventListener("change", function () {
      const type = document.getElementById("typeSelect").value;
      const cate1 = document.getElementById("cate1Select").value;
      const cate2 = this.value;
      const cate3Options =
        type && cate1 && cate2 &&
        optionsTree[type] && optionsTree[type][cate1] &&
        optionsTree[type][cate1][cate2]
          ? optionsTree[type][cate1][cate2]
          : [];
      populateSelect("cate3Select", cate3Options);
    }); 

    //let optionsTree = {};

    // fetch(OPTIONS_URL)
    //   .then(response => response.json())
    //   .then(data => {
    //     populateSelect("typeSelect", data.type);
    //     populateSelect("cate1Select", data.cate1);
    //     populateSelect("cate2Select", data.cate2);
    //     populateSelect("cate3Select", data.cate3);
    //   })
    //   .catch(error => {
    //     console.error("選択肢の読み込みに失敗しました:", error);
    //   });

    // function populateSelect(selectId, options) {
    //   const select = document.getElementById(selectId);
    //   options.forEach(value => {
    //     const opt = document.createElement("option");
    //     opt.value = value;
    //     opt.textContent = value;
    //     select.appendChild(opt);
    //   });
    // }


    document.getElementById("logForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);

      fetch("https://script.google.com/macros/s/AKfycbwddQbwMSW1TeLl-2VSLXXhV84m0YhpP0mAmKusGiVgx4qTW3xMDVl-a84y4lW754ud/exec", {
        method: "POST",
        body: new URLSearchParams(formData)
      }).then(response => {
        if (response.ok) {
          alert("送信完了！");
          e.target.reset();

          // 送信後も日付と時間を再設定
          const now = new Date();
          document.getElementById("dateInput").value = now.toISOString().slice(0, 10);
          document.getElementById("timeInput").value = now.toTimeString().slice(0, 5);
        } else {
          alert("送信に失敗しました");
        }
      });
    });
  </script>
</body>
</html>
